{% extends "base.html" %}

{% load url from future %}

{% block body %}
<section id="sidePane" ng-controller="SidePaneCtrl">
  <div id="selectedSubject">
    <h2 id="selectedName">No Subject Selected</h2>
    <h4 id="selectedCode">Use the search to find a subject</h4>
  </div>

  {% if user.is_authenticated %}
  <div id="subjectAdder" ng-controller="SubjectAddCtrl" popup ng-cloak>
    <div class="sidePaneBtnWrapper">
      <button id="subjectAdderAddBtn" class="btn btn-primary" type="button" ng-cloak ng-click="togglePopup($event)">Add Subject</button>
      <button id="subjectAdderDelBtn" class="btn btn-danger" type="button" ng-cloak ng-click="toggleDelPopup($event)">Remove Subject</button>
    </div>
    <div id="subjectAdderSection" ng-show="isVisible()" ng-submit="addSubject($event)">
      <h2 class="add-heading">Adding <span class="add-heading-subj" ng-bind="selected()"></span></h2>
      <form name="subjectAdderForm" id="subjectAdderForm" class="form-horizontal">
        {% csrf_token %}
        <div class="form-group">
          <label for="subjectAdderYear" class="col-sm-4 control-label">Year</label>
          <div class="col-sm-4">
            <input id="subjectAdderYear" class="form-control" name="subjectYear" type="number" ng-model="modelYear" min="2000" max="2020" required>
          </div>
          <div class="control-label pull-left">
            <span ng-hide="isValidYear()" class="label label-danger error-label">Invalid Year</span>
          </div>
        </div>
        <div class="form-group">
          <label for="subjectAdderSemester" class="col-sm-4 control-label">Semester</label>
          <div class="col-sm-4">
            <select name="subjectSemester" id="subjectAdderSemester" class="form-control" ng-model="modelSemester" ng-options="semester for semester in semesters"></select>
          </div>
          <div class="control-label pull-left">
            <span ng-hide="isValidSemester()" class="label label-danger error-label">Invalid Semester</span>
          </div>
        </div>
        <div class="form-group">
          <label for="subjectAdderState" class="col-sm-4 control-label">State</label>
          <div class="col-sm-4">
            <select name="subjectState" id="subjectAdderState" class="form-control" ng-model="modelState" ng-options="state for state in states"></select>
          </div>
          <div class="control-label pull-left">
            <span ng-hide="isValidState()" class="label label-danger error-label">Invalid Semester</span>
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-2"></div>
          <button id="subjectAdderConfirmBtn" class="col-sm-3 btn btn-success" type="submit">Add</button>
          <div class="col-sm-1"></div>
          <button class="col-sm-3 btn btn-default" ng-click="togglePopup($event)" type="button">Cancel</button>
        </div>
      </form>
    </div>
    <div id="subjDelConfirm" ng-show="isDelVisible()">
      <p class="space-up-10">Are you sure you want to remove</p>
      <p><b ng-bind="delSubjCode"></b></p>
      <i class="close-popup glyphicon glyphicon-remove" ng-click="toggleDelPopup($event)"></i>
      <button class="btn btn-danger" type="button" ng-click="deleteSubject($event)">Remove</button>
      <button class="btn btn-default" type="button" ng-click="toggleDelPopup($event)">Cancel</button>
    </div>
  </div>
  {% endif %}
  <div id="typeSwitcher" class="graphActions" ng-controller="GraphTypeCtrl">
    <div ng-show="onGraphPage()" class="btn-group">
      <span class="btn btn-default" ng-class="{active: prereq()}" ng-cloak ng-click="toPre()">Prerequisites</span>
      <span class="btn btn-default" ng-class="{active: !prereq()}" ng-cloak ng-click="toPost()">Postrequisites</span>
    </div>
  </div>


  <div id="statistics">
    <h4 class="subjectMeta">Status</h4>
    <h5 class="statisticsLabel">All Students</h5>
    <ul id="statisticsInfo" class="statisticsList">
      <li class="statisticsItem" id="nCompleted"></li>
      <li class="statisticsItem" id="nStudying"></li>
      <li class="statisticsItem" id="nPlanned"></li>
      <li class="statisticsItem" id="nBookmarked"></li>
    </ul>
    {% if is_social %}
    <div id="socialInfo" ng-controller="SocialCtrl" popup ng-cloak>
      <h4 class="statisticsLabel">Friends</h4>
      <ul id="socialStatisticsInfo" class="statisticsList">
        <li class="socialStatisticsItem" id="nSocialCompleted" ng-click="togglePopupCompleted($event)"></li>
        <li class="socialStatisticsItem" id="nSocialStudying" ng-click="togglePopupStudying($event)"></li>
        <li class="socialStatisticsItem" id="nSocialPlanned" ng-click="togglePopupPlanned($event)"></li>
        <li class="socialStatisticsItem" id="nSocialBookmarked" ng-click="togglePopupBookmarked($event)"></li>
      </ul>

      <div id="socialCompleted" class="socialInfoPopup" ng-show="isVisibleCompleted()">
        <h4 class="socialPopupHeading">Friends completed this subject</h4>
        <ul id="friendsInfoCompleted" class="friendsInfo"></ul>
      </div>
      <div id="socialStudying" class="socialInfoPopup" ng-show="isVisibleStudying()">
        <h4 class="socialPopupHeading">Friends studying this subject</h4>
        <ul id="friendsInfoStudying" class="friendsInfo"></ul>
      </div>
      <div id="socialPlanned" class="socialInfoPopup" ng-show="isVisiblePlanned()">
        <h4 class="socialPopupHeading">Friends planned this subject</h4>
        <ul id="friendsInfoPlanned" class="friendsInfo"></ul>
      </div>
      <div id="socialBookmarked" class="socialInfoPopup" ng-show="isVisibleBookmarked()">
        <h4 class="socialPopupHeading">Friends bookmarked this subject</h4>
        <ul id="friendsInfoBookmarked" class="friendsInfo"></ul>
      </div>
    </div>
    {% endif %}
  </div>

  <div id="creditPoint">
    <h4 class="subjectDetailHeading">Credit Points</h4>
    <p class="subjectDetail" id="creditPointDetail"></p>
  </div>
  <div id="semester">
    <h4 class="subjectDetailHeading">Semester</h4>
    <p class="subjectDetail" id="semesterDetail"></p>
  </div>
  <div id="timeCommit">
    <h4 class="subjectDetailHeading">Time Commitment</h4>
    <p class="subjectDetail" id="timeCommitDetail"></p>
  </div>
  <div id="prerequisites">
    <h4 class="subjectDetailHeading">Prerequisites</h4>
    <p class="subjectDetail" id="prerequisitesDetail"></p>
  </div>
  <div id="assessments">
    <h4 class="subjectDetailHeading">Assessment</h4>
    <p class="subjectDetail" id="assessmentsDetail"></p>
  </div>
  <div id="corequisites">
    <h4 class="subjectDetailHeading">Corequisites</h4>
    <p class="subjectDetail" id="corequisitesDetail"></p>
  </div>
  <div id="subjectOverview">
    <h4 class="subjectDetailHeading">Subject Overview</h4>
    <p class="subjectDetail" id="subjectOverviewDetail"></p>
  </div>
  <div id="objectives">
    <h4 class="subjectDetailHeading">Objectives</h4>
    <p class="subjectDetail" id="objectivesDetail"></p>
  </div>
</section>

<section ng-view id="graphContainer"></section>

<section id="legend" class="default" ng-controller="LegendCtrl">
  <i id="legendCloseIcon" class="glyphicon glyphicon-remove" ng-click="toggleLegend()"></i>
  <i id="legendOpenIcon" class="glyphicon glyphicon-info-sign" ng-click="toggleLegend()"></i>

  <div id="legendGraph"></div>
</section>
{% endblock %}

{% block search-bar %}
<section id="search" ng-controller="SearchCtrl" ng-cloak popup>
  <input type="text" id="searchInput" placeholder="Search" ng-click="toggleSearch($event)" ng-model="query">
  <button class="btn btn-default" id="searchBtn" ng-click="toggleSearch($event)">
    <i class="glyphicon glyphicon-search"></i>
  </button>
  <div id="searchResult" ng-show="isVisible()">
    <table>
      {% verbatim %}
      <tr data-code="{{node.code}}" ng-click="replacePath(node.code)"
          ng-repeat="node in subjects | filter:query | limitTo: 100">
        <td ng-bind="node.code"></td>
        <td ng-bind="node.name"></td>
      </tr>
      {% endverbatim %}
    </table>
  </div>
</section>
{% endblock %}
